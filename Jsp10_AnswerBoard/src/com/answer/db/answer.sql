DROP SEQUENCE BOARDNOSEQ;
DROP SEQUENCE GROUPNOSEQ;

DROP TABLE ANSWERBOARD;

CREATE SEQUENCE BOARDNOSEQ;
CREATE SEQUENCE GROUPNOSEQ;

CREATE TABLE ANSWERBOARD(
BOARDNO NUMBER PRIMARY KEY,   --글번호 
GROUPNO NUMBER NOT NULL, --그룹번호 
GROUPSEQ NUMBER NOT NULL, --그룹순서 
TITLETAB  NUMBER NOT NULL, --제목공
TITLE VARCHAR2(1000) NOT NULL, --제목 
CONTENT VARCHAR2(4000) NOT NULL, --내용 
WRITER VARCHAR2(400) NOT NULL, --작성자 
REGDATE DATE NOT NULL --작성일 
);


SELECT BOARDNO, GROUPNO, GROUPSEQ, TITLETAB, TITLE, CONTENT, WRITER,
REGDATE
FROM ANSWERBOARD
ORDER BY GROUPNO DESC, GROUPSEQ;



--글작성
INSERT INTO ANSWERBOARD
VALUES(BOARDNOSEQ.NEXTVAL, GROUPNOSEQ.NEXTVAL, 1, 0 ,
'답변형 게시판 ', '사실 더 쉬운 방법이 있지만 oracle외에서도 사용하고 싶어서 ','강사',SYSDATE);
--그룹순서는 1, 제목앞의 공백은 0



INSERT INTO ANSWERBOARD
VALUES(BOARDNOSEQ.NEXTVAL, GROUPNOSEQ.NEXTVAL, 1, 0 ,
'두번쨰글  ', '두번쨰 내용 ', '두번쨰작성자 ',SYSDATE);


--2번글에 답변
--update: 부모의 글과 같은 그룹이면서, 부모의 순서 다음순서에 있는 글들을 찾아서, 순서+1

UPDATE ANSWERBOARD
SET GROUPSEQ = GROUPSEQ + 1
WHERE GROUPNO = (SELECT GROUPNO FROM ANSWERBOARD WHERE BOARDNO = 2)
AND GROUPSEQ > (SELECT GROUPSEQ FROM ANSWERBOARD WHERE BOARDNO = 2);  












--insert: 부모의 글과 같은 그룹,부모의 순서 +1, 부모의 제목공백 +1
INSERT INTO ANSWERBOARD
VALUES(BOARDNOSEQ.NEXTVAL,
(SELECT GROUPNO FROM ANSWERBOARD WHERE BOARDNO =2),
(SELECT GROUPSEQ +1 FROM ANSWERBOARD WHERE BOARDNO =2),
(SELECT TITLETAB +1 FROM ANSWERBOARD WHERE BOARDNO =2),
'RE:두번째글','내용','첫번째리글',SYSDATE );


--3번글 (2번의 답변글)에다가 답변
--update 와 insert 가 하나로 묶인 것 -> 최소한의 작업단위 :1개 -이걸 transaction 이라고 함
UPDATE ANSWERBOARD
SET GROUPSEQ = GROUPSEQ + 1
WHERE GROUPNO =(SELECT GROUPNO FROM ANSWERBOARD WHERE BOARDNO=3)
AND GROUPSEQ > (SELECT GROUPSEQ FROM ANSWERBOARD WHERE BOARDNO = 3);
  
--INSERT
INSERT INTO ANSWERBOARD
VALUES(BOARDNOSEQ.NEXTVAL,
(SELECT GROUPNO FROM ANSWERBOARD WHERE BOARDNO = 3),
(SELECT GROUPSEQ FROM ANSWERBOARD WHERE BOARDNO = 3)+1,
(SELECT TITLETAB FROM ANSWERBOARD WHERE BOARDNO = 3)+ 1,
'  RE:RE:두번쟤','두번째답변내용','홍길동',SYSDATE);






